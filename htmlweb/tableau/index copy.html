<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>

<div class="jumbotron text-center">
  <h1>My First Bootstrap Page</h1>
  <p>Resize this responsive page to see the effect!</p> 
</div>
  
<div class="container">
  <div class="row">
    <div id="content" class="col-sm-4">

        <div class="form-group">
            <label for="locality-dropdown">Select list:</label>
            <select class="form-control" onchange="loadfetchCity()" id="locality-dropdown" name="locality">

            </select>
          </div>


    </div>

    <div class="col-sm-4">
      <h3>SERVICE</h3>
      <a href="#" class="btn btn-primary" onclick="loadfetchCity('http://marc.in2p3.fr:8080/api/v0/msgs/WorkloadManagement/SiteDirectorBiomed-1')">loadfetchCity</a>
    </div>


    <div class="col-sm-4">
    <div class="dropup">
        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Dropup Example
        <span class="caret"></span></button>
        <ul class="dropdown-menu"  id="locality-dropdown" name="locality">
      
        </ul>
      </div>
    </div>
  </div>

  
  </div>




  <div class="container">
  <div class="row" id="display-resources">
    
  </div>
</div>
</div>
</div>

<script>


function myFunction() {
  var x = document.getElementById("mySelect").value;
  document.getElementById("demo").innerHTML = "You selected: " + x;
}

    function loadfetchCity() {

 let    varcity = document.getElementById("locality-dropdown").value;
console.log(varcity);
        let displayResources = document.querySelector("#display-resources");
        displayResources.textContent =
            "Loading data from JSON source...";
        fetch('http://marc.in2p3.fr:8080/api/v0/msgs/'+varcity)
      
            .then(function (response) {
                if (response.ok)
                    return response.json();
                    console.log('reponse'+response);
                throw new Error('Response is not OK');
            })
            .then(function (result) {
                let output =
                    "<table class='table table-striped'><thead><tr><th scope='col'>Name</th><th scope='col'>Provider</th><th>URL</th></thead><tbody>";
                for (let i in result) {
                    output +=
                        "<tr><td>" +
                        result[i].asctime +
                        "</td><td>" +
                        result[i].componentname +
                        "</td><td>" +
                        result[i].levelname +
                        "</td></tr>";
                }
                output += "</tbody></table>";
                displayResources.innerHTML = output;
            })
            .catch(function (error) {
                console.log(error);
            });
    };




let dropdown = document.getElementById('locality-dropdown');
dropdown.length = 0;

let defaultOption = document.createElement('option');
defaultOption.text = 'Choose State/Province';

dropdown.add(defaultOption);
dropdown.selectedIndex = 0;

const url = 'http://marc.in2p3.fr:8080/api/v0/services';

fetch(url)  
.then(  
function(response) {  
  if (response.status !== 200) {  
    console.warn('Looks like there was a problem. Status Code: ' + 
      response.status);  
    return;  
  }

  // Examine the text in the response  
  response.json().then(function(data) {  
  //  data=data.results;
  //console.log(data);
    let option;
  
  for (let i = 0; i < data.length; i++) {
      option = document.createElement('option');
      option.text = data[i];
     option.value = data[i];

      dropdown.add(option);
//onchange= console.log('valeuuu'+ data[i]);
  }    
  });  
}  
)  
.catch(function(err) {  
console.error('Fetch Error -', err);  
});
</script>

</body>
</html>


